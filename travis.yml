language: node_js
node_js:
  - 21.1 # Use the version you need

services:
  - docker
  - mysql

install:
  - echo "nothing needs to be installed"

before_script:
  - mysql -e 'CREATE DATABASE IF NOT EXISTS authDB;
    CREATE DATABASE IF NOT EXISTS productDB;
    CREATE DATABASE IF NOT EXISTS orderDB;
    CREATE DATABASE IF NOT EXISTS ecommerceDB;'
    # Additional commands to seed data if required

script:
  - docker --version # print the version for logging
  # Build images for your microservices
  - docker build -t auth-service ./auth-service
  - docker build -t product-service ./product-service
  - docker build -t order-service ./order-service
  - docker build -t reverseproxy ./reverseproxy-service

  # Tag the images
  - docker tag auth-service onwardfave/auth-service:v1
  - docker tag product-service onwardfave/product-service:v1
  - docker tag order-service onwardfave/order-service:v1
  - docker tag reverseproxy onwardfave/reverseproxy:v1

after_success:
  - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
  - docker push onwardfave/auth-service:v1
  - docker push onwardfave/product-service:v1
  - docker push onwardfave/order-service:v1
  - docker push onwardfave/reverseproxy:v1
